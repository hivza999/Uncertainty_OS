	bits 32
	global	_start

	section .text

	%define Keycode_status		0x9f000
	%define	Keycode_register	0x9f002
	%define ASCII_input_register	0x9f003

	%define	Scancode_set		0x9f100

_start:
	; Initialization

	; keycode table and ASCII layout initialization
	mov	esi, scancodeset1
	mov	edi, Scancode_set

scancodeset1_initialization_loop:
	mov	edx, [esi]
	mov	[edi], edx

	add	esi, 4
	add	edi, 4

	cmp	esi, ASCII_layout_QWERTY_end
	jb	scancodeset1_initialization_loop

	; Initialize keycode registers

	mov	dword [Keycode_status], 0x00
	mov	byte [Keycode_register], 0x00
	mov	byte [ASCII_input_register], 0x00

	; init idt
	extern idt_init
	call idt_init

	; start main kernel
	extern main
	call main
	jmp $

	section .data

align 16
scancodeset1:

	; 0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f
db	0x00, 0x01, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x40
db	0x41, 0x42, 0x43, 0x44, 0x45, 0x46, 0x47, 0x48, 0x49, 0x4a, 0x4b, 0x4c, 0x6c, 0xa0, 0x61, 0x62
db	0x63, 0x64, 0x65, 0x66, 0x67, 0x68, 0x69, 0x6a, 0x6b, 0x20, 0x80, 0x4d, 0x81, 0x82, 0x83, 0x84
db	0x85, 0x86, 0x87, 0x88, 0x89, 0x8a, 0x8b, 0x33, 0xa2, 0xa3, 0x60, 0x02, 0x03, 0x04, 0x05, 0x06
db	0x07, 0x08, 0x09, 0x0a, 0x0b, 0x31, 0x0f, 0x51, 0x52, 0x53, 0x34, 0x71, 0x72, 0x73, 0x54, 0x91
db	0x92, 0x93, 0xb1, 0xb3, 0x00, 0x00, 0x00, 0x0c, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

; extended bytes
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x94, 0xac, 0x00, 0x00
db	0xff, 0xff, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00
db	0xff, 0x00, 0xff, 0x00, 0x00, 0x32, 0x00, 0x00, 0xa9, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2f, 0x8f, 0x30, 0x00, 0xae, 0x00, 0xb0, 0x00, 0x4f
db	0xaf, 0x50, 0x2e, 0x4e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa1, 0xaa, 0xab, 0xff, 0xff
db	0x00, 0x00, 0x00, 0xff, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

scancodeset1_end:


ASCII_layout_QWERTY:

	; 0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f	   0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f
db	0x00, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	'`',  '1',  '2',  '3',  '4',  '5',  '6',  '7',  '8',  '9',  '0',  '-',  '=',  0x08, 0x00, 0x00, 0x00, 0x00, '/',  '*',  '-' , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x09, 'q',  'w',  'e',  'r',  't',  'y',  'u',  'i',  'o',  'p',  '[',  ']',  '\',  0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, '+',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 'a',  's',  'd',  'f',  'g',  'h',  'j',  'k',  'l',  0x3b, "'",  0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 'z',  'x',  'c',  'v',  'b',  'n',  'm',  ',',  '.',  '/',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, ' ',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

; uppercase layout
	; 0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f	   0     1     2     3     4     5     6     7     8     9     a     b     c     d     e     f
db	0x00, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	'~',  '!',  '@',  '#',  '$',  '%',  '^',  '&',  '*',  '(',  ')',  '_',  '+',  0x08, 0x00, 0x00, 0x00, 0x00, '/',  '*',  '-' , 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x09, 'Q',  'W',  'E',  'R',  'T',  'Y',  'U',  'I',  'O',  'P',  '{',  '}',  '|',  0x7f, 0x00, 0x00, '7',  '8',  '9',  '+',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 'A',  'S',  'D',  'F',  'G',  'H',  'J',  'K',  'L',  ':',  '"',  0x0a, 0x00, 0x00, 0x00, 0x00, '4',  '5',  '6',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 'Z',  'X',  'C',  'V',  'B',  'N',  'M',  '<',  '>',  '?',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, '1',  '2',  '3',  0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, ' ',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, '0',  0x00, '.',  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
db	0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00

ASCII_layout_QWERTY_end:
